<!DOCTYPE html>
<html lang="en">
  <head>
    <title>PlanetTrivia</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>

    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css?family=Gugi" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Orbitron" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Audiowide" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=VT323" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Mina" rel="stylesheet">

    <style>

      body{
        background-color: #014;
        background-image: url("space1.jpg");
        background-size: 300%;
        background-position: left;
        background-position: -15px;
      }

      #b {
        background-repeat: repeat;
        background-image: url("space1.jpg");
        background-size: 200%;
        margin: -10px;
        padding-bottom: 8%;
      }

      #text {
        padding-bottom: 1%;
        border-bottom: 0.95px solid gray;
        font-family: 'Gugi', cursive;
        font-size: 290%;
        text-align: center;
        margin-top: -0.05%;
        color: white;
        background:rgba(30,30,120,0.55);

      }

      #type {
        font-family: 'Orbitron', sans-serif;
        font-style: italic;
        font-size: 800%;
        text-align: center;
        margin-top: 16%;
        text-shadow: 0px 0px 15px black;
      }

      .cursor {
        color: white;
      }

      #button {
        font-family: 'Orbitron', sans-serif;
        font-size: 230%;
        text-shadow: 0px 0px 10px blue;
        padding: 7%;
        background:rgba(20,20,20,0.8);
        color: white;
        border: 2px solid white;
        box-shadow: 0px 0px 10px white;
        margin-left: 35%;
        border-radius: 8px;
        margin-top: -2%;
        margin-bottom: 5%;
      }

      #button:hover {
        background-color: white;
        color: black;
        border: 2px solid white;
      }

      @media only screen and (max-width: 500px) {

        #text { text-align: center;
        }

        #type { font-size: 300%;
        }

        #button {
          font-size: 250%;
          padding: 15%;
          width: 95%;
          margin-left: 2.5%;
          margin-top: 18%;
        }

        #b { background-size: 170% 160%;
        }


      }

    </style>
  </head>
  <body>
    <div id="b">
      <div>
        <header>
          <p id="text"><i>PlanetTrivia</i></p>
        </header>
        <div>
          <h1 id="type"><span style="color: white">SAVE OUR<br/></span>
            <span class="typer" id="main" data-words="WATER,FOOD,PLANET" data-colors="white" data-delay="150" data-deleteDelay="1000"></span>
            <span class="cursor" data-owner="main"></span>
          </h1>

        </div>

      </div>

    </div>
    <div id="buttons">
    </div>
  </body>
</html>

<script>

  var b = document.getElementById("buttons");
  b.innerHTML = "<a href='join_session.html'><button id='button'>Play Now!</button></a>";


  var Typer = function(element) {
    this.element = element;
    var delim = element.dataset.delim || ","; // default to comma
    var words = element.dataset.words || "override these,sample typing";
    this.words = words.split(delim).filter(function(v){return v;}); // non empty words
    this.delay = element.dataset.delay || 200;
    this.loop = element.dataset.loop || "true";
    this.deleteDelay = element.dataset.deletedelay || element.dataset.deleteDelay || 800;

    this.progress = { word:0, char:0, building:true, atWordEnd:false, looped: 0 };
    this.typing = true;

    var colors = element.dataset.colors || "black";
    this.colors = colors.split(",");
    this.element.style.color = this.colors[0];
    this.colorIndex = 0;

    this.doTyping();
  };

  Typer.prototype.start = function() {
    if (!this.typing) {
      this.typing = true;
      this.doTyping();
    }
  };
  Typer.prototype.stop = function() {
    this.typing = false;
  };
  Typer.prototype.doTyping = function() {
    var e = this.element;
    var p = this.progress;
    var w = p.word;
    var c = p.char;
    var currentDisplay = [...this.words[w]].slice(0, c).join("");
    p.atWordEnd = false;
    if (this.cursor) {
      this.cursor.element.style.opacity = "1";
      this.cursor.on = true;
      clearInterval(this.cursor.interval);
      var itself = this.cursor;
      this.cursor.interval = setInterval(function() {itself.updateBlinkState();}, 400);
    }

    e.innerHTML = currentDisplay;

    if (p.building) {
      if (p.char == [...this.words[w]].length) {
        p.building = false;
        p.atWordEnd = true;
      } else {
        p.char += 1;
      }
    } else {
      if (p.char == 0) {
        p.building = true;
        p.word = (p.word + 1) % this.words.length;
        this.colorIndex = (this.colorIndex + 1) % this.colors.length;
        this.element.style.color = this.colors[this.colorIndex];
      } else {
        p.char -= 1;
      }
    }

    if(p.atWordEnd) p.looped += 1;

    if(!p.building && (this.loop == "false" || this.loop <= p.looped) ){
      this.typing = false;
    }

    var myself = this;
    setTimeout(function() {
      if (myself.typing) { myself.doTyping(); };
    }, p.atWordEnd ? this.deleteDelay : this.delay);
  };

  var Cursor = function(element) {
    this.element = element;
    this.cursorDisplay = element.dataset.cursordisplay || "|";
    element.innerHTML = this.cursorDisplay;
    this.on = true;
    element.style.transition = "all 0.1s";
    var myself = this;
    this.interval = setInterval(function() {
      myself.updateBlinkState();
    }, 400);
  }
  Cursor.prototype.updateBlinkState = function() {
    if (this.on) {
      this.element.style.opacity = "0";
      this.on = false;
    } else {
      this.element.style.opacity = "1";
      this.on = true;
    }
  }

  function TyperSetup() {
    var typers = {};
    var elements = document.getElementsByClassName("typer");
    for (var i = 0, e; e = elements[i++];) {
      typers[e.id] = new Typer(e);
    }
    var elements = document.getElementsByClassName("typer-stop");
    for (var i = 0, e; e = elements[i++];) {
      let owner = typers[e.dataset.owner];
      e.onclick = function(){owner.stop();};
    }
    var elements = document.getElementsByClassName("typer-start");
    for (var i = 0, e; e = elements[i++];) {
      let owner = typers[e.dataset.owner];
      e.onclick = function(){owner.start();};
    }

    var elements2 = document.getElementsByClassName("cursor");
    for (var i = 0, e; e = elements2[i++];) {
      let t = new Cursor(e);
      t.owner = typers[e.dataset.owner];
      t.owner.cursor = t;
    }
  }

  TyperSetup();

</script>
